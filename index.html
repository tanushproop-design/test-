<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ANIMETHUGS — Watch & Share</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />

<style>
:root{
  --bg:#0b0f1a;
  --panel:#0f1523;
  --card:#121828;
  --text:#eaf2fb;
  --muted:#9fb0c2;
  --brand:#5ac8fa;
  --accent:#7c5cfc;
  --primary-bg: linear-gradient(135deg,var(--accent),var(--brand));
  --primary-color: #071022;
  --secondary-bg: rgba(255,255,255,0.04);
  --secondary-color: var(--text);
}

/* base */
*{box-sizing:border-box;scroll-behavior:smooth}
body{
  margin:0;
  font-family:Inter,system-ui,sans-serif;
  color:var(--text);
  background: linear-gradient(180deg,#071022 0%, #0b0f1a 100%);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  min-height:100vh;
}

/* nav */
header{position:sticky;top:16px;z-index:100;display:flex;justify-content:center;align-items:center;position:relative}
.liquid-nav{position:relative;display:flex;gap:6px;padding:8px;border-radius:32px;background:rgba(18,24,40,.65);backdrop-filter:blur(22px) saturate(180%);box-shadow:0 16px 40px rgba(80,150,255,.18);align-items:center}
.liquid-indicator{position:absolute;top:6px;bottom:6px;width:0;border-radius:26px;background:radial-gradient(120% 120% at 30% 30%,rgba(255,255,255,.45),rgba(90,200,250,.55),rgba(74,139,255,.5));opacity:.55;transition:left .45s,width .45s,opacity .25s;z-index:0}
.nav-item{position:relative;padding:10px 20px;border-radius:26px;font-size:14px;font-weight:600;color:var(--text);text-decoration:none;z-index:1;transition:transform 180ms,color 180ms}
.nav-item:hover{transform:translateY(-1px);color:white}
#profilePicNav:hover{transform:scale(1.1);border-color:var(--brand);transition:transform 0.2s, border-color 0.2s}

/* nav right */
.nav-right{display:flex;gap:8px;align-items:center;position:absolute;right:20px;top:50%;transform:translateY(-50%)}
.btn-primary-ui{padding:8px 12px;border-radius:10px;border:none;font-weight:700;cursor:pointer;background:var(--primary-bg);color:var(--primary-color)}
.btn-secondary-ui{padding:8px 12px;border-radius:10px;border:none;font-weight:700;cursor:pointer;background:var(--secondary-bg);color:var(--secondary-color)}

/* sections */
section{padding:120px 20px;opacity:0;transform:translateY(30px);transition:opacity .9s ease,transform .9s ease}
section.reveal{opacity:1;transform:none}
.wrap{max-width:1080px;margin:0 auto;position:relative}
.wrap > .panel, .wrap > .hero-card { position: relative; z-index: 1; }
.wrap.section-glow::before{content:"";position:absolute;left:-12px;right:-12px;top:-12px;bottom:-12px;border-radius:18px;pointer-events:none;box-shadow:0 0 48px 14px rgba(124,92,252,0.12), inset 0 18px 40px rgba(92,200,250,0.06);opacity:0;transform:scale(.98);animation:wrapGlow .95s ease forwards;mix-blend-mode:screen}
@keyframes wrapGlow{0%{opacity:0;transform:scale(.98)}8%{opacity:1;transform:scale(1)}72%{opacity:.9;transform:scale(1.01)}100%{opacity:0;transform:scale(1.02)}}

#home{padding-top:160px}
.hero-grid{display:grid;grid-template-columns:1fr 1fr;gap:32px;align-items:center}
.hero-card{background:rgba(18,24,40,.75);border-radius:18px;padding:24px}
.site-title{font-size:38px;font-weight:800}
.watch-box{background:#0e1424;border-radius:14px;padding:18px;margin-top:14px}
.headline{color:var(--brand);font-weight:700}
.btn-primary{margin-top:14px;display:inline-block;padding:10px 16px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--brand));color:#0b1020;font-weight:700;text-decoration:none}

/* gif */
.hero-gif img{max-width:480px;border-radius:14px;display:block}
.hero-gif{position:relative;display:flex;align-items:center;justify-content:center;overflow:visible;padding-top:8px}
.hero-gif img{transition:transform 320ms cubic-bezier(.2,.9,.2,1),filter 320ms ease,opacity 220ms ease;transform-origin:center top;z-index:1}
.hero-gif:hover img{transform:scale(1.06) translateY(-3px);filter:drop-shadow(0 18px 30px rgba(92,200,250,0.12)) saturate(1.06)}
.hero-gif::before{content:"";position:absolute;left:50%;top:50%;width:200px;height:200px;transform:translate(-50%,-50%) scale(.95);border-radius:50%;background:radial-gradient(circle at 40% 35%, rgba(90,200,250,.18) 0%, rgba(124,92,252,.08) 36%, transparent 70%);filter:blur(18px);opacity:0;transition:opacity 260ms ease, transform 320ms cubic-bezier(.2,.9,.2,1);mix-blend-mode:screen;z-index:0}
.hero-gif:hover::before{opacity:1;transform:translate(-50%,-50%) scale(1.06)}

@media(max-width:900px){.hero-grid{grid-template-columns:1fr}.hero-gif{display:none}}

.panel{background:var(--panel);border-radius:18px;padding:40px}
footer{padding:40px 20px;text-align:center;color:var(--muted)}

/* modal */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.7);display:none;align-items:center;justify-content:center;z-index:999}
.modal{background:var(--card);padding:26px;border-radius:14px;text-align:center;max-width:420px;width:calc(100% - 48px);box-shadow:0 12px 40px rgba(0,0,0,0.45);transform:translateY(6px) scale(0.98)}
.modal h2{margin:0 0 12px;font-size:20px}
.modal p{margin:0 0 12px;color:var(--muted)}
.modal input[type="text"], .modal input[type="password"], .modal input[type="email"]{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:var(--text);margin-top:8px}

/* profile modal specific */
.profile-modal {
  max-width: 500px;
  width: calc(100% - 40px);
  position: fixed;
  top: 60px;
  right: 20px;
  left: auto;
  transform: none;
  text-align: left;
}
.profile-modal h2 { text-align: center; }

/* close button */
.modal-close {
  position: absolute;
  top: 10px;
  right: 10px;
  background: none;
  border: none;
  color: var(--text);
  font-size: 24px;
  cursor: pointer;
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: background 0.2s;
}
.modal-close:hover {
  background: rgba(255, 255, 255, 0.1);
}

/* auth buttons container */
.auth-actions{display:flex;gap:10px;justify-content:center;margin-top:12px}
.auth-actions .btn { min-width:120px; }

/* toast */
.toast{position:fixed;bottom:28px;right:28px;background:rgba(40,44,56,0.95);color:var(--text);padding:12px 16px;border-radius:10px;box-shadow:0 8px 30px rgba(0,0,0,0.45);transform:translateY(12px);opacity:0;transition:opacity 260ms ease,transform 260ms ease;z-index:1200;max-width:320px}
.toast.show{opacity:1;transform:translateY(0)}

/* uploader demo */
.uploader{margin-top:18px;display:none;gap:12px;align-items:center;flex-direction:column}
.uploader input[type="text"], .uploader input[type="file"]{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:var(--text)}

/* hover glow */
.wrap.hover-glow > .panel, .wrap.hover-glow > .hero-card { box-shadow:0 18px 40px rgba(92,200,250,0.06); transform:translateY(-6px) }
.wrap.hover-glow.strong > .panel, .wrap.hover-glow.strong > .hero-card { box-shadow:0 30px 80px rgba(124,92,252,0.18); transform:translateY(-8px) }

#adult-magazine { display: none; }

/* ============================
   MOBILE OPTIMIZATIONS (FINAL FINAL)
   ============================ */

@media (max-width: 900px) {
  .hero-grid { grid-template-columns: 1fr; }
  .hero-gif { display: none; }
}

/* TABLET & PHONE */
@media (max-width: 768px) {

  /* HEADER */
  header {
    top: 8px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
  }

  /* NAV BAR */
  .liquid-nav {
    padding: 6px 8px;
    gap: 6px;
    width: 100%;
    justify-content: center;
    flex-wrap: wrap;
    align-items: center;
    position: relative;
  }

  .nav-item {
    padding: 6px 12px;
    font-size: 12.5px;
    min-height: 36px;
  }

  /* DEFAULT: NAV-RIGHT BELOW (LOGGED OUT) */
  .nav-right {
    position: static;
    transform: none;
    width: 100%;
    display: flex;
    justify-content: center;
    margin-top: 4px;
  }

  /* LOGIN / CREATE — BELOW NAV */
  #loginBtn {
    padding: 6px 16px;
    font-size: 13px;
    min-height: 36px;
    border-radius: 18px;
    white-space: nowrap;
  }

  /* LOGGED IN STATE — PROFILE PIC ON RIGHT */
  #profilePicNav {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    width: 32px;
    height: 32px;
    min-width: 32px;
    padding: 0;
    border-radius: 50%;
    overflow: hidden;
  }

  /* CONTENT */
  section { padding: 72px 14px; }
  .wrap { max-width: 100%; }
  .hero-card { padding: 18px; }
  .site-title { font-size: 30px; }
  .watch-box { padding: 14px; }
  .panel { padding: 22px; }

  /* MODALS */
  .modal {
    width: calc(100% - 28px);
    padding: 16px;
  }

  .modal h2 { font-size: 17px; }

  .auth-actions {
    flex-direction: column;
    gap: 8px;
  }

  .auth-actions .btn {
    min-width: 100%;
  }

  .profile-modal {
    max-width: 90vw;
    width: 90vw;
    top: 10px;
    right: 10px;
    left: auto;
  }
}

/* SMALL PHONES */
@media (max-width: 480px) {

  .liquid-nav {
    padding: 4px 6px;
    border-radius: 22px;
  }

  .nav-item {
    padding: 5px 10px;
    font-size: 12px;
  }

  .site-title { font-size: 26px; }
  .headline { font-size: 13px; }
  .watch-box p { font-size: 13px; }

  .btn-primary {
    padding: 6px 12px;
    font-size: 13px;
  }

  .panel { padding: 18px; }
  section { padding: 56px 10px; }

  .modal { padding: 14px; }
  .modal h2 { font-size: 15px; }
  .modal p { font-size: 13px; }

  footer { padding: 18px 10px; }
}

/* TOUCH-FRIENDLY */
.nav-item,
#loginBtn,
#profilePicNav {
  display: flex;
  align-items: center;
  justify-content: center;
}



</style>
</head>
<body>

<header>
  <nav class="liquid-nav" role="navigation" aria-label="Main navigation">
    <div class="liquid-indicator" id="liquidIndicator"></div>
    <a class="nav-item" href="#home">Home</a>
    <a class="nav-item" href="#about">About</a>
    <a class="nav-item" href="#stream">Stream</a>
    <a class="nav-item" href="#adult-magazine" id="adultLink">Adult Magazine</a>
    <a class="nav-item" href="#contact">Contact</a>
  </nav>
  <div class="nav-right">
    <button id="loginBtn" class="btn-primary-ui">Login / Create</button>
    <button id="profilePicNav" style="display:none;width:40px;height:40px;border-radius:50%;background:var(--secondary-bg);cursor:pointer;border:2px solid var(--text);overflow:hidden;display:flex;align-items:center;justify-content:center;border:none;padding:0;">
      <img id="navProfilePic" src="" alt="Profile" style="width:100%;height:100%;object-fit:cover;display:none;">
      <span id="navProfilePlaceholder" style="color:var(--muted);font-size:12px;">P</span>
    </button>
  </div>
</header>

<section id="home">
  <div class="wrap hero-grid">
    <div class="hero-card">
      <h1 class="site-title">ANIMETHUGS</h1>
      <div class="watch-box">
        <div class="headline">Now Streaming</div>
        <p>Curated anime dubs and videos, hand‑picked by the Anime Thugs team.</p>
        <a class="btn-primary" href="https://watchthugs.run.place/">Watch</a>

        <div class="uploader" id="uploader">
          <input type="text" id="videoTitle" placeholder="Video title (e.g., Episode 1)" />
          <input type="file" id="videoFile" accept="video/*" />
          <div style="display:flex;gap:8px;margin-top:8px;">
            <button id="uploadBtn" class="btn-primary-ui">Upload (demo)</button>
            <button id="clearBtn" class="btn-secondary-ui">Clear</button>
          </div>
          <div id="uploadStatus" style="margin-top:8px;color:var(--muted);font-size:13px;"></div>
        </div>
      </div>
    </div>

    <div class="hero-gif">
      <div class="gif-card" role="img" aria-label="Animated character">
        <img src="miku-hatsune.gif" alt="Miku Hatsune animation">
      </div>
    </div>
  </div>
</section>

<section id="about">
  <div class="wrap panel">
    <h2>About AnimeThugs</h2>
    <p>AnimeThugs is a curated platform for high-quality anime dubs and exclusive content.</p>
  </div>
</section>

<section id="stream">
  <div class="wrap panel">
    <h2>Streaming</h2>
    <p>Featured anime, trending dubs and hand-picked episodes.</p>
  </div>
</section>

<section id="adult-magazine">
  <div class="wrap panel">
    <h2>Adult Magazine Section</h2>
    <p>This section is age-restricted. Confirm you are 18+ to view the content here.</p>
  </div>
</section>

<section id="contact">
  <div class="wrap panel">
    <h2>Contact</h2>
    <p>Support Email: contact@animethugs.com</p>
    <p>Business Email: support@animethugs.com</p>
  </div>
</section>

<footer>
  © <span id="year"></span> ANIMETHUGS
</footer>

<!-- AGE GATE -->
<div class="modal-overlay" id="ageModal" aria-hidden="true">
  <div class="modal" role="dialog" aria-labelledby="ageTitle" aria-modal="true">
    <h2 id="ageTitle">Are you 18+?</h2>
    <p>Please confirm that you are 18 years of age or older to access the Adult Magazine section.</p>
    <div style="display:flex;gap:10px;justify-content:center;margin-top:12px;">
      <button id="ageYes" class="btn-primary-ui">Yes</button>
      <button id="ageNo" class="btn-secondary-ui">No</button>
    </div>
  </div>
</div>

<!-- LOGIN / CREATE -->
<div class="modal-overlay" id="loginModal" aria-hidden="true">
  <div class="modal" role="dialog" aria-labelledby="loginTitle" aria-modal="true">
    <button class="modal-close" id="loginClose" aria-label="Close">&times;</button>
    <h2 id="loginTitle">Account</h2>
    <p id="loginSubtitle" style="color:var(--muted);margin-bottom:8px">Login or create a free account. Owner/moderator can use the same popup to sign in.</p>

    <div id="authForms">
      <div id="loginForm">
        <input id="loginUser" type="text" placeholder="Username" autocomplete="username" />
        <input id="loginPass" type="password" placeholder="Password" autocomplete="current-password" />
        <div class="auth-actions">
          <button id="loginSubmit" class="btn-primary-ui btn auth-btn">Login</button>
          <button id="showCreate" class="btn-secondary-ui btn auth-btn">Create account</button>
        </div>
        <div id="loginError" style="color:#ffb4b4;margin-top:10px;display:none;font-size:13px;"></div>
      </div>

      <div id="createForm" style="display:none">
        <input id="createUser" type="text" placeholder="Choose a username" />
        <input id="createName" type="text" placeholder="Your name" />
        <input id="createEmail" type="email" placeholder="Email (optional)" />
        <input id="createPass" type="password" placeholder="Choose a password" />
        <div class="auth-actions">
          <button id="createSubmit" class="btn-primary-ui btn auth-btn">Create account</button>
          <button id="showLogin" class="btn-secondary-ui btn auth-btn">Back to login</button>
        </div>
        <div id="createError" style="color:#ffb4b4;margin-top:10px;display:none;font-size:13px;"></div>
        <div id="createSuccess" style="color:#b8ffda;margin-top:10px;display:none;font-size:13px;"></div>
      </div>
    </div>
  </div>
</div>

<!-- PROFILE MODAL -->
<div class="modal-overlay" id="profileModal" aria-hidden="true">
  <div class="modal profile-modal" role="dialog" aria-labelledby="profileTitle" aria-modal="true">
    <button class="modal-close" id="profileClose" aria-label="Close">&times;</button>
    <h2 id="profileTitle">Profile</h2>
    <div style="text-align:center;margin-bottom:20px;">
      <div id="profilePicContainer" style="width:100px;height:100px;border-radius:50%;background:var(--secondary-bg);margin:0 auto 10px;display:flex;align-items:center;justify-content:center;overflow:hidden;cursor:pointer;">
        <img id="profilePic" src="" alt="Profile Picture" style="width:100%;height:100%;object-fit:cover;display:none;">
        <span id="profilePicPlaceholder" style="color:var(--muted);">No Image</span>
      </div>
      <input type="file" id="profilePicInput" accept="image/*" style="display:none;">
    </div>
    <div style="margin-bottom:15px;">
      <label for="profileName" style="display:block;margin-bottom:5px;color:var(--text);">Name</label>
      <input id="profileName" type="text" placeholder="Your name" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:var(--text);">
    </div>
    <div style="margin-bottom:15px;">
      <label for="profileUsername" style="display:block;margin-bottom:5px;color:var(--text);">Username</label>
      <input id="profileUsername" type="text" placeholder="Username" readonly style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:var(--muted);">
    </div>
    <div style="margin-bottom:20px;">
      <label for="profileEmail" style="display:block;margin-bottom:5px;color:var(--text);">Email</label>
      <input id="profileEmail" type="email" placeholder="Email" readonly style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:var(--muted);">
    </div>
    <div style="text-align:center;margin-bottom:15px;">
      <button id="advancedBtn" class="btn-secondary-ui" style="width:100%;">Advanced Options</button>
    </div>
    <div id="advancedSection" style="display:none;border-top:1px solid rgba(255,255,255,0.1);padding-top:15px;text-align:center;">
      <button id="updateEmailBtn" class="btn-secondary-ui" style="width:100%;margin-bottom:10px;">Update Email</button>
      <button id="changePasswordBtn" class="btn-secondary-ui" style="width:100%;margin-bottom:10px;">Change Password</button>
      <button id="deleteAccountBtn" style="width:100%;padding:10px;border-radius:8px;border:none;background:linear-gradient(135deg,#ff4757,#ff3838);color:white;font-weight:600;cursor:pointer;">Delete Account</button>
    </div>
    <div style="border-top:1px solid rgba(255,255,255,0.1);padding-top:15px;text-align:center;">
      <p id="accountType" style="margin:0 0 15px;color:var(--text);font-weight:600;">Account Type: Normal</p>
      <button id="profileLogout" class="btn-secondary-ui" style="width:100%;">Logout</button>
    </div>
  </div>
</div>

<!-- PASSWORD CONFIRM MODAL -->
<div class="modal-overlay" id="passwordModal" aria-hidden="true">
  <div class="modal" role="dialog" aria-labelledby="passwordTitle" aria-modal="true">
    <button class="modal-close" id="passwordClose" aria-label="Close">&times;</button>
    <h2 id="passwordTitle">Confirm Password</h2>
    <input id="confirmPassword" type="password" placeholder="Enter your current password" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:var(--text);margin-bottom:15px;">
    <button id="confirmPasswordBtn" class="btn-primary-ui" style="width:100%;">Confirm</button>
  </div>
</div>

<!-- NEW EMAIL MODAL -->
<div class="modal-overlay" id="newEmailModal" aria-hidden="true">
  <div class="modal" role="dialog" aria-labelledby="newEmailTitle" aria-modal="true">
    <button class="modal-close" id="newEmailClose" aria-label="Close">&times;</button>
    <h2 id="newEmailTitle">Update Email</h2>
    <input id="newEmail" type="email" placeholder="Enter new email" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:var(--text);margin-bottom:15px;">
    <button id="saveNewEmailBtn" class="btn-primary-ui" style="width:100%;">Update Email</button>
  </div>
</div>

<!-- CHANGE PASSWORD MODAL -->
<div class="modal-overlay" id="changePasswordModal" aria-hidden="true">
  <div class="modal" role="dialog" aria-labelledby="changePasswordTitle" aria-modal="true">
    <button class="modal-close" id="changePasswordClose" aria-label="Close">&times;</button>
    <h2 id="changePasswordTitle">Change Password</h2>
    <input id="currentPassword" type="password" placeholder="Current password" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:var(--text);margin-bottom:10px;">
    <input id="newPassword" type="password" placeholder="New password" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:var(--text);margin-bottom:10px;">
    <input id="confirmNewPassword" type="password" placeholder="Confirm new password" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:var(--text);margin-bottom:15px;">
    <button id="saveNewPasswordBtn" class="btn-primary-ui" style="width:100%;">Change Password</button>
  </div>
</div>

<!-- DELETE ACCOUNT MODAL -->
<div class="modal-overlay" id="deleteModal" aria-hidden="true">
  <div class="modal" role="dialog" aria-labelledby="deleteTitle" aria-modal="true">
    <button class="modal-close" id="deleteClose" aria-label="Close">&times;</button>
    <h2 id="deleteTitle">Delete Account</h2>
    <input id="deletePassword" type="password" placeholder="Enter password" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:var(--text);margin-bottom:10px;">
    <input id="confirmDeletePassword" type="password" placeholder="Confirm password" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:var(--text);margin-bottom:15px;">
    <button id="confirmDeleteBtn" style="width:100%;padding:10px;border-radius:8px;border:none;background:linear-gradient(135deg,#ff4757,#ff3838);color:white;font-weight:600;cursor:pointer;">Delete Account</button>
  </div>
</div>

<div class="toast" id="denyToast" role="status" aria-live="polite">You need to be 18+ to access this content.</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // dynamic year
  document.getElementById('year').textContent = new Date().getFullYear();

  /* NAV indicator */
  const indicator = document.getElementById('liquidIndicator');
  const items = document.querySelectorAll('header .nav-item');
  function moveIndicator(el){
    const r = el.getBoundingClientRect();
    const n = el.parentElement.getBoundingClientRect();
    indicator.style.left = (r.left - n.left) + 'px';
    indicator.style.width = r.width + 'px';
  }
  items.forEach(i=>{
    i.addEventListener('mouseenter', ()=>{ moveIndicator(i); indicator.classList.add('active'); });
    i.addEventListener('mouseleave', ()=>indicator.classList.remove('active'));
    i.addEventListener('click', (e)=>{
      if (i.id === 'adultLink') { openAgeGate(e); return; }
      moveIndicator(i);
      indicator.classList.add('active');
      setTimeout(()=>indicator.classList.remove('active'),260);
      const href = i.getAttribute('href');
      if (href && href.startsWith('#')) setTimeout(()=>flashWrap(href),140);
    });
  });
  if (items[0]) moveIndicator(items[0]);

  /* Section reveal */
  const observer = new IntersectionObserver(entries => { entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('reveal'); }); }, { threshold: .2 });
  document.querySelectorAll('section').forEach(s => observer.observe(s));
  function flashWrap(selector){
    if (!selector) return;
    const sec = document.querySelector(selector);
    if (!sec) return;
    const wrap = sec.querySelector('.wrap') || sec;
    wrap.classList.remove('section-glow');
    void wrap.offsetWidth;
    wrap.classList.add('section-glow');
    setTimeout(()=>wrap.classList.remove('section-glow'),1100);
  }

  /* Age gate */
  const ageModal = document.getElementById('ageModal');
  const ageYes = document.getElementById('ageYes');
  const ageNo = document.getElementById('ageNo');
  function openAgeGate(e){ if (e && e.preventDefault) e.preventDefault(); ageModal.style.display = 'flex'; ageModal.setAttribute('aria-hidden','false'); document.body.style.overflow = 'hidden'; ageYes.focus(); }
  function closeAgeGate(){ ageModal.style.display = 'none'; ageModal.setAttribute('aria-hidden','true'); document.body.style.overflow = ''; }
  function showDenyToast(msg){ const t = document.getElementById('denyToast'); t.textContent = msg || 'You need to be 18+ to access this content.'; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),3200); }
  function allowAccess(){ closeAgeGate(); const target = document.getElementById('adult-magazine'); if (target){ target.style.display = 'block'; target.classList.add('reveal'); const wrap = target.querySelector('.wrap') || target; if (wrap){ wrap.classList.add('section-glow'); setTimeout(()=>wrap.classList.remove('section-glow'),950); } target.scrollIntoView({behavior:'smooth',block:'start'}); } }
  function denyAccess(){ closeAgeGate(); showDenyToast(); }
  ageYes.addEventListener('click', allowAccess);
  ageNo.addEventListener('click', denyAccess);

  /* AUTH UI elements */
  const loginBtn = document.getElementById('loginBtn');
  const loginModal = document.getElementById('loginModal');
  const loginForm = document.getElementById('loginForm');
  const createForm = document.getElementById('createForm');
  const showCreate = document.getElementById('showCreate');
  const showLogin = document.getElementById('showLogin');
  const loginUser = document.getElementById('loginUser');
  const loginPass = document.getElementById('loginPass');
  const loginSubmit = document.getElementById('loginSubmit');
  const loginError = document.getElementById('loginError');
  const createUser = document.getElementById('createUser');
  const createName = document.getElementById('createName');
  const createEmail = document.getElementById('createEmail');
  const createPass = document.getElementById('createPass');
  const createSubmit = document.getElementById('createSubmit');
  const createError = document.getElementById('createError');
  const createSuccess = document.getElementById('createSuccess');
  const ownerBadge = document.getElementById('ownerBadge');
  const uploader = document.getElementById('uploader');

  /* Profile modal elements */
  const profileBtn = document.getElementById('profilePicNav');
  const navProfilePic = document.getElementById('navProfilePic');
  const navProfilePlaceholder = document.getElementById('navProfilePlaceholder');
  const profileModal = document.getElementById('profileModal');
  const profileClose = document.getElementById('profileClose');
  const profilePicContainer = document.getElementById('profilePicContainer');
  const profilePicInput = document.getElementById('profilePicInput');
  const profilePic = document.getElementById('profilePic');
  const profilePicPlaceholder = document.getElementById('profilePicPlaceholder');
  const profileName = document.getElementById('profileName');
  const profileUsername = document.getElementById('profileUsername');
  const profileEmail = document.getElementById('profileEmail');
  const advancedBtn = document.getElementById('advancedBtn');
  const advancedSection = document.getElementById('advancedSection');
  const updateEmailBtn = document.getElementById('updateEmailBtn');
  const changePasswordBtn = document.getElementById('changePasswordBtn');
  const deleteAccountBtn = document.getElementById('deleteAccountBtn');
  const profileLogout = document.getElementById('profileLogout');
  const accountType = document.getElementById('accountType');

  /* Additional modal elements */
  const passwordModal = document.getElementById('passwordModal');
  const passwordClose = document.getElementById('passwordClose');
  const confirmPassword = document.getElementById('confirmPassword');
  const confirmPasswordBtn = document.getElementById('confirmPasswordBtn');
  const newEmailModal = document.getElementById('newEmailModal');
  const newEmailClose = document.getElementById('newEmailClose');
  const newEmail = document.getElementById('newEmail');
  const saveNewEmailBtn = document.getElementById('saveNewEmailBtn');
  const changePasswordModal = document.getElementById('changePasswordModal');
  const changePasswordClose = document.getElementById('changePasswordClose');
  const currentPassword = document.getElementById('currentPassword');
  const newPasswordInput = document.getElementById('newPassword');
  const confirmNewPassword = document.getElementById('confirmNewPassword');
  const saveNewPasswordBtn = document.getElementById('saveNewPasswordBtn');
  const deleteModal = document.getElementById('deleteModal');
  const deleteClose = document.getElementById('deleteClose');
  const deletePassword = document.getElementById('deletePassword');
  const confirmDeletePassword = document.getElementById('confirmDeletePassword');
  const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');

  /* Profile modal functions */
  function openProfileModal() {
    profileModal.style.display = 'flex';
    profileModal.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';
    loadProfileData();
  }
  function closeProfileModal() {
    profileModal.style.display = 'none';
    profileModal.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
  }
  function openPasswordModal() {
    passwordModal.style.display = 'flex';
    passwordModal.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';
    confirmPassword.focus();
  }
  function closePasswordModal() {
    passwordModal.style.display = 'none';
    passwordModal.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
    confirmPassword.value = '';
  }
  function openNewEmailModal() {
    newEmailModal.style.display = 'flex';
    newEmailModal.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';
    newEmail.focus();
  }
  function closeNewEmailModal() {
    newEmailModal.style.display = 'none';
    newEmailModal.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
    newEmail.value = '';
  }
  function openChangePasswordModal() {
    changePasswordModal.style.display = 'flex';
    changePasswordModal.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';
    currentPassword.focus();
  }
  function closeChangePasswordModal() {
    changePasswordModal.style.display = 'none';
    changePasswordModal.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
    currentPassword.value = '';
    newPasswordInput.value = '';
    confirmNewPassword.value = '';
  }
  function openDeleteModal() {
    deleteModal.style.display = 'flex';
    deleteModal.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';
    deletePassword.focus();
  }
  function closeDeleteModal() {
    deleteModal.style.display = 'none';
    deleteModal.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
    deletePassword.value = '';
    confirmDeletePassword.value = '';
  }
  function loadProfileData() {
    const user = getLocalSession() || (API_BASE ? null : null); // For demo, use local
    if (user) {
      const users = loadLocalUsers();
      const rec = users[user];
      if (rec) {
        profileUsername.value = user;
        profileEmail.value = rec.email || '';
        profileName.value = rec.name || '';
        accountType.textContent = 'Account Type: ' + (rec.role === 'owner' || rec.role === 'moderator' ? 'Owner' : 'User');
        // Load profile pic
        const pic = localStorage.getItem('profilePic_' + user);
        if (pic) {
          profilePic.src = pic;
          profilePic.style.display = 'block';
          profilePicPlaceholder.style.display = 'none';
          navProfilePic.src = pic;
          navProfilePic.style.display = 'block';
          navProfilePlaceholder.style.display = 'none';
        } else {
          profilePic.style.display = 'none';
          profilePicPlaceholder.style.display = 'block';
          navProfilePic.style.display = 'none';
          navProfilePlaceholder.style.display = 'block';
        }
      }
    }
  }
  function saveProfileData() {
    const user = getLocalSession();
    if (user) {
      const users = loadLocalUsers();
      if (users[user]) {
        users[user].name = profileName.value;
        users[user].email = profileEmail.value;
        saveLocalUsers(users);
      }
    }
  }

  profileBtn.addEventListener('click', openProfileModal);
  profileClose.addEventListener('click', closeProfileModal);
  profileLogout.addEventListener('click', () => {
    closeProfileModal();
    localStorage.removeItem('animethugs_jwt_v1');
    clearLocalSession();
    applySessionUI();
    const t = document.getElementById('denyToast');
    if (t){ t.textContent = 'Signed out'; t.classList.add('show'); setTimeout(()=>{ t.classList.remove('show'); t.textContent = 'You need to be 18+ to access this content.'; },1600); }
  });
  advancedBtn.addEventListener('click', () => {
    advancedSection.style.display = advancedSection.style.display === 'none' ? 'block' : 'none';
  });
  updateEmailBtn.addEventListener('click', () => {
    openPasswordModal();
  });
  changePasswordBtn.addEventListener('click', () => {
    openChangePasswordModal();
  });
  deleteAccountBtn.addEventListener('click', () => {
    openDeleteModal();
  });
  /* Additional modal listeners */
  passwordClose.addEventListener('click', closePasswordModal);
  confirmPasswordBtn.addEventListener('click', () => {
    const user = getLocalSession();
    const users = loadLocalUsers();
    const rec = users[user];
    if (rec && rec.password === confirmPassword.value) {
      closePasswordModal();
      openNewEmailModal();
    } else {
      alert('Incorrect password.');
    }
  });
  newEmailClose.addEventListener('click', closeNewEmailModal);
  saveNewEmailBtn.addEventListener('click', () => {
    const newEmailValue = newEmail.value.trim();
    if (newEmailValue) {
      profileEmail.value = newEmailValue;
      saveProfileData();
      closeNewEmailModal();
      alert('Email updated!');
    } else {
      alert('Please enter a valid email.');
    }
  });
  changePasswordClose.addEventListener('click', closeChangePasswordModal);
  saveNewPasswordBtn.addEventListener('click', () => {
    const user = getLocalSession();
    const users = loadLocalUsers();
    const rec = users[user];
    if (rec.password !== currentPassword.value) {
      alert('Current password is incorrect.');
      return;
    }
    if (newPasswordInput.value !== confirmNewPassword.value) {
      alert('New passwords do not match.');
      return;
    }
    if (newPasswordInput.value.length < 1) {
      alert('Password cannot be empty.');
      return;
    }
    users[user].password = newPasswordInput.value;
    saveLocalUsers(users);
    closeChangePasswordModal();
    alert('Password changed successfully!');
  });
  deleteClose.addEventListener('click', closeDeleteModal);
  confirmDeleteBtn.addEventListener('click', () => {
    const user = getLocalSession();
    const users = loadLocalUsers();
    const rec = users[user];
    if (rec.password !== deletePassword.value) {
      alert('Incorrect password.');
      return;
    }
    if (deletePassword.value !== confirmDeletePassword.value) {
      alert('Passwords do not match.');
      return;
    }
    delete users[user];
    saveLocalUsers(users);
    localStorage.removeItem('profilePic_' + user);
    clearLocalSession();
    applySessionUI();
    closeDeleteModal();
    closeProfileModal();
    alert('Account deleted.');
  });
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      closeProfileModal();
      closePasswordModal();
      closeNewEmailModal();
      closeChangePasswordModal();
      closeDeleteModal();
    }
  });
  profilePicContainer.addEventListener('click', () => {
    profilePicInput.click();
  });
  profilePicInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (event) => {
        profilePic.src = event.target.result;
        profilePic.style.display = 'block';
        profilePicPlaceholder.style.display = 'none';
        navProfilePic.src = event.target.result;
        navProfilePic.style.display = 'block';
        navProfilePlaceholder.style.display = 'none';
        // Save to localStorage
        const user = getLocalSession();
        if (user) localStorage.setItem('profilePic_' + user, event.target.result);
      };
      reader.readAsDataURL(file);
    }
  });
  // Save on input change
  profileName.addEventListener('input', saveProfileData);

  /* Local fallback DB keys and owner seed */
  const LOCAL_USERS_KEY = 'animethugs_local_users_v1';
  const LOCAL_SESSION_KEY = 'animethugs_local_session_v1';
  const OWNER_USERNAME = 'Owneer.exe';
  const OWNER_PASSWORD = 'Exe12099';

  function loadLocalUsers(){
    try {
      const raw = localStorage.getItem(LOCAL_USERS_KEY);
      const parsed = raw ? JSON.parse(raw) : {};
      if (!parsed[OWNER_USERNAME]) {
        parsed[OWNER_USERNAME] = { password: OWNER_PASSWORD, email: '', role: 'owner' };
        localStorage.setItem(LOCAL_USERS_KEY, JSON.stringify(parsed));
      }
      return parsed;
    } catch (e) {
      const fallback = {};
      fallback[OWNER_USERNAME] = { password: OWNER_PASSWORD, email: '', role: 'owner' };
      localStorage.setItem(LOCAL_USERS_KEY, JSON.stringify(fallback));
      return fallback;
    }
  }
  function saveLocalUsers(users){ localStorage.setItem(LOCAL_USERS_KEY, JSON.stringify(users)); }
  function setLocalSession(username){ localStorage.setItem(LOCAL_SESSION_KEY, username); }
  function clearLocalSession(){ localStorage.removeItem(LOCAL_SESSION_KEY); }
  function getLocalSession(){ return localStorage.getItem(LOCAL_SESSION_KEY); }

  /* Determine whether a server is available.
     If the page is opened via file:// or API_BASE is explicitly null, we skip server calls.
     If you later host this file from a server, set API_BASE to '' (same origin) or your server URL.
  */
  const runningFromFile = (location.protocol === 'file:');
  // If you host on a server and want to use it, set API_BASE to '' or 'https://yourserver'
  const API_BASE = runningFromFile ? null : ''; // null => no server calls

  // helper: try server call, but only if API_BASE is not null
  async function apiPost(path, body){
    if (!API_BASE) return { ok: false, error: 'no-server' };
    try {
      const res = await fetch(API_BASE + path, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      const json = await res.json();
      if (!res.ok) return { ok: false, error: json.error || 'server error' };
      return { ok: true, data: json };
    } catch (err) {
      return { ok: false, error: err.message || 'network' };
    }
  }

  /* open/close login modal */
  function openLoginModal(){ loginModal.style.display = 'flex'; loginModal.setAttribute('aria-hidden','false'); document.body.style.overflow = 'hidden'; loginForm.style.display=''; createForm.style.display='none'; loginError.style.display='none'; createError.style.display='none'; createSuccess.style.display='none'; loginUser.focus(); }
  function closeLoginModal(){ loginModal.style.display = 'none'; loginModal.setAttribute('aria-hidden','true'); document.body.style.overflow = ''; }

  loginBtn.addEventListener('click', openLoginModal);
  document.getElementById('loginClose').addEventListener('click', closeLoginModal);
  document.addEventListener('keydown', (e)=>{ if (e.key === 'Escape'){ closeLoginModal(); closeAgeGate(); } });

  showCreate.addEventListener('click', (e)=>{ e.preventDefault(); loginForm.style.display='none'; createForm.style.display=''; createUser.focus(); });
  showLogin.addEventListener('click', (e)=>{ e.preventDefault(); createForm.style.display='none'; loginForm.style.display=''; loginUser.focus(); });

  /* apply session UI:
     - If server token exists and server is available, verify /api/me
     - Otherwise fallback to local session
  */
  async function applySessionUI(){
    // server token path
    if (API_BASE) {
      const token = localStorage.getItem('animethugs_jwt_v1');
      if (token) {
        try {
          const res = await fetch(API_BASE + '/api/me', { headers: { 'Authorization': 'Bearer ' + token } });
          if (res.ok) {
            const json = await res.json();
            const role = json.user.role;
            document.getElementById('profilePicNav').style.display='flex';
            if (role === 'owner' || role === 'moderator'){ uploader.style.display='flex'; } else { uploader.style.display='none'; }
            loginBtn.style.display='none';
            return;
          } else {
            // invalid token -> clear and fallback to local
            localStorage.removeItem('animethugs_jwt_v1');
          }
        } catch (e) {
          // network error -> fall through to local fallback
        }
      }
    }

    // local fallback
    const localUser = getLocalSession();
    if (!localUser) {
      document.getElementById('profilePicNav').style.display='none';
      loginBtn.style.display='inline-block';
      uploader.style.display='none';
      return;
    }
    const users = loadLocalUsers();
    const rec = users[localUser];
    if (!rec) { clearLocalSession(); applySessionUI(); return; }
    document.getElementById('profilePicNav').style.display='flex';
    if (rec.role === 'owner' || rec.role === 'moderator'){ uploader.style.display='flex'; } else { uploader.style.display='none'; }
    loginBtn.style.display='none';
  }

  /* Register (create account) */
  createSubmit.addEventListener('click', async (e)=>{
    e.preventDefault();
    createError.style.display='none'; createSuccess.style.display='none';
    const username = (createUser.value||'').trim();
    const name = (createName.value||'').trim();
    const password = (createPass.value||'').trim();
    const email = (createEmail.value||'').trim();
    if (!username || !password){ createError.textContent='Username and password required'; createError.style.display='block'; return; }

    // If server available, try server registration first
    if (API_BASE) {
      const serverRes = await apiPost('/api/register', { username, password, email, name });
      if (serverRes.ok) {
        localStorage.setItem('animethugs_jwt_v1', serverRes.data.token);
        createSuccess.textContent = 'Account created and signed in (server)';
        createSuccess.style.display = 'block';
        setTimeout(()=>{ closeLoginModal(); applySessionUI(); },700);
        return;
      } else {
        // server returned error (username exists etc.) — show it
        createError.textContent = serverRes.error || 'Registration failed';
        createError.style.display = 'block';
        return;
      }
    }

    // Local fallback: create user in localStorage
    const users = loadLocalUsers();
    if (users[username]) { createError.textContent='Username already exists. Choose another.'; createError.style.display='block'; return; }
    users[username] = { password, email, name, role: 'viewer' };
    saveLocalUsers(users);
    setLocalSession(username);
    createSuccess.textContent = 'Account created and signed in (local)';
    createSuccess.style.display = 'block';
    setTimeout(()=>{ closeLoginModal(); applySessionUI(); },700);
  });

  /* Login */
  loginSubmit.addEventListener('click', async (e)=>{
    e.preventDefault();
    loginError.style.display='none';
    const username = (loginUser.value||'').trim();
    const password = (loginPass.value||'').trim();
    if (!username || !password){ loginError.textContent='Enter username and password'; loginError.style.display='block'; return; }

    // If server available, try server login first
    if (API_BASE) {
      const serverRes = await apiPost('/api/login', { username, password });
      if (serverRes.ok) {
        localStorage.setItem('animethugs_jwt_v1', serverRes.data.token);
        closeLoginModal();
        applySessionUI();
        return;
      } else {
        // server responded with error (invalid credentials etc.)
        loginError.textContent = serverRes.error || 'Login failed';
        loginError.style.display = 'block';
        return;
      }
    }

    // Local fallback login
    const users = loadLocalUsers();
    const rec = users[username];
    if (!rec || rec.password !== password){ loginError.textContent='Invalid username or password'; loginError.style.display='block'; return; }
    setLocalSession(username);
    closeLoginModal();
    applySessionUI();
  });

  /* Uploader demo: checks server role if available, otherwise local role */
  const uploadBtn = document.getElementById('uploadBtn');
  const clearBtn = document.getElementById('clearBtn');
  const videoFile = document.getElementById('videoFile');
  const videoTitle = document.getElementById('videoTitle');
  const uploadStatus = document.getElementById('uploadStatus');

  uploadBtn.addEventListener('click', async ()=>{
    uploadStatus.textContent = '';

    // If server available and token present, verify role server-side
    if (API_BASE) {
      const token = localStorage.getItem('animethugs_jwt_v1');
      if (token) {
        try {
          const res = await fetch(API_BASE + '/api/me', { headers: { 'Authorization': 'Bearer ' + token } });
          if (res.ok) {
            const j = await res.json();
            if (j.user.role !== 'owner' && j.user.role !== 'moderator'){ uploadStatus.textContent = 'Only owner or moderator can upload.'; return; }
            // proceed (demo)
          } else {
            localStorage.removeItem('animethugs_jwt_v1');
          }
        } catch (e) {
          // network error -> fallback to local
        }
      }
    }

    // Local fallback check
    const localUser = getLocalSession();
    if (!localUser) { uploadStatus.textContent = 'You must be logged in as owner to upload.'; return; }
    const users = loadLocalUsers();
    const rec = users[localUser];
    if (!rec || (rec.role !== 'owner' && rec.role !== 'moderator')){ uploadStatus.textContent = 'Only owner or moderator can upload.'; return; }

    const file = videoFile.files[0];
    const title = videoTitle.value.trim() || (file ? file.name : '');
    if (!file){ uploadStatus.textContent = 'Please choose a video file to upload.'; return; }
    const allowed = ['video/mp4','video/webm','video/ogg'];
    if (!allowed.includes(file.type)){ uploadStatus.textContent = 'Unsupported file type. Use MP4/WebM/OGG.'; return; }
    if (file.size > 1024 * 1024 * 1024){ uploadStatus.textContent = 'File too large (demo limit 1GB).'; return; }

    uploadStatus.textContent = 'Uploading...';
    uploadBtn.disabled = true; clearBtn.disabled = true;
    let progress = 0;
    const progInterval = setInterval(()=>{ progress += Math.floor(Math.random()*12)+6; uploadStatus.textContent = `Uploading... ${Math.min(progress,100)}%`; if (progress >= 100){ clearInterval(progInterval); setTimeout(()=>{ uploadStatus.textContent = `Upload complete (demo). Title: "${title}"`; uploadBtn.disabled = false; clearBtn.disabled = false; },400); } },220);
  });

  clearBtn.addEventListener('click', ()=>{ videoFile.value=''; videoTitle.value=''; uploadStatus.textContent=''; });

  /* Hover glow on sections */
  (function enableSectionHoverGlow(){
    const sections = document.querySelectorAll('section');
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    sections.forEach(section=>{
      const wrap = section.querySelector('.wrap') || section;
      const targetEl = wrap.querySelector('.panel') || wrap.querySelector('.hero-card') || wrap;
      section.addEventListener('pointerenter', ()=>{
        wrap.classList.add('hover-glow');
        if (!prefersReducedMotion && targetEl && targetEl.animate){
          targetEl.getAnimations().forEach(a=>a.cancel());
          targetEl.animate([{boxShadow:'none',transform:'translateY(0)'},{boxShadow:'0 18px 40px rgba(92,200,250,0.06)',transform:'translateY(-6px)'}],{duration:420,easing:'cubic-bezier(.2,.9,.2,1)',fill:'forwards'});
        }
      },{passive:true});
      section.addEventListener('pointerleave', ()=>{
        wrap.classList.remove('hover-glow','strong');
        if (!prefersReducedMotion && targetEl && targetEl.animate){
          targetEl.getAnimations().forEach(a=>a.cancel());
          targetEl.animate([{boxShadow:getComputedStyle(targetEl).boxShadow||'0 18px 40px rgba(92,200,250,0.06)',transform:getComputedStyle(targetEl).transform||'translateY(-6px)'},{boxShadow:'none',transform:'translateY(0)'}],{duration:300,easing:'ease-out',fill:'forwards'});
        }
      },{passive:true});
      section.addEventListener('focusin', ()=>{ wrap.classList.add('hover-glow','strong'); });
      section.addEventListener('focusout', ()=>{ wrap.classList.remove('hover-glow','strong'); });
      section.addEventListener('pointerdown', ()=>{ if (!targetEl || prefersReducedMotion) return; targetEl.animate([{transform:'translateY(0) scale(1)'},{transform:'translateY(-2px) scale(0.995)'},{transform:'translateY(0) scale(1)'}],{duration:220,easing:'cubic-bezier(.2,.9,.2,1)'}); },{passive:true});
    });
  })();

  // initialize local users and UI
  loadLocalUsers();
  applySessionUI();
});
</script>
</body>
</html>

